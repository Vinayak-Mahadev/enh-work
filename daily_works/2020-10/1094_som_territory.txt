--interface id 
1094 
DAILY_DUMP - SOM Summary Territory

-- header

Channel|Region|Area|Sales Area|Cluster|Micro Cluster|Additional Territory|TerriotryID|Product Brand|Product Type|Product Category|PRODUCT ID|PRODUCT EXT ID|PRODUCT NAME|Qty|Avg Gross (7 Day)|SOM(Day Remaining)


-- query 

select '1094_SOM_Summary_Territory' as report_name, report_org_master.channel_category_v as channel, report_org_master.region_v as region, report_org_master.area_v as area, report_org_master.sales_area_v as salesarea, report_org_master.cluster_v as cluster, report_org_master.micro_cluster_v as microcluster, null as additionalterritory, report_org_master.org_short_code_v as territoryid, product_brand.metrics_name_v as productbrand, null as producttype, product_category.metrics_name_v as productcategory, product_master.metrics_id_n::text as productid, product_master.ext_reference_id_v as productextid, product_master.metrics_name_v as productname, sum(groupby_query_results.closing_qty_n) as qty, case when (sum(groupby_query_results.stock_in_qty_n) - sum(groupby_query_results.stock_out_qty_n)) > 0 then round(((sum(groupby_query_results.stock_in_qty_n) - sum(groupby_query_results.stock_out_qty_n))/7),0) else (sum(groupby_query_results.stock_in_qty_n) - sum(groupby_query_results.stock_out_qty_n)) end as avgqty, case when (sum(groupby_query_results.stock_in_qty_n) - sum(groupby_query_results.stock_out_qty_n)) > 0 and round(((sum(groupby_query_results.stock_in_qty_n) - sum(groupby_query_results.stock_out_qty_n))/7),0) > 0 then round((sum(groupby_query_results.closing_qty_n)/round(((sum(groupby_query_results.stock_in_qty_n) - sum(groupby_query_results.stock_out_qty_n))/7),0)),0) else -1 end as businessdays from (select daily_stock_ledger.org_id_n as org_id_n, daily_stock_ledger.metrics_id_n as metrics_id_n, sum(daily_stock_ledger.closing_stock_qty_n) as closing_qty_n, sum(average_stock_ledger.stock_in_qty_n) as stock_in_qty_n, sum(average_stock_ledger.stock_out_qty_n) as stock_out_qty_n from kpi.tr_daily_stock_ledger as daily_stock_ledger inner join kpi.tr_daily_stock_ledger as average_stock_ledger on (daily_stock_ledger.day_id_n = (select to_number(to_char((select date 'yesterday'),'yyyymmdd'),'99999999')) and average_stock_ledger.day_id_n between (select to_char((select date 'yesterday' - interval '6 days'),'yyyymmdd')::numeric) and daily_stock_ledger.day_id_n and daily_stock_ledger.account_id_n = average_stock_ledger.account_id_n and daily_stock_ledger.node_id_n = average_stock_ledger.node_id_n and daily_stock_ledger.org_id_n = average_stock_ledger.org_id_n and daily_stock_ledger.metrics_id_n = average_stock_ledger.metrics_id_n) group by daily_stock_ledger.org_id_n, daily_stock_ledger.metrics_id_n ) as groupby_query_results inner join kpi.ms_report_org_master as report_org_master on (report_org_master.org_id_n = groupby_query_results.org_id_n) inner join kpi.ms_metrics_master as product_master on (groupby_query_results.metrics_id_n = product_master.metrics_id_n) inner join kpi.ms_metrics_master as product_category on (product_category.metrics_type_n = 11 and product_category.metrics_id_n = product_master.category_id_n) left join kpi.ms_metrics_master as product_brand on (product_brand.metrics_type_n = 16::numeric and product_brand.metrics_id_n = product_master.brand_id_n) group by channel, region, area, salesarea, cluster, microcluster, additionalterritory, territoryid, producttype, productbrand, productcategory, productname, productid, productextid;



SCHEDULAR_FOR_PULLDATA_FROM_POSTGERS_1094=0 30 2 * * ? *
SCHEDULAR_FOR_PROCESS_FILE_1094=0 0 4 * * ? *

