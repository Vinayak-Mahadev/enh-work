1168_DAILY_JOIN_QUERY_1= select 1168 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 21 as instance_type_n, coalesce(temp.instance_key_v::numeric,0) as instance_id_n, temp.file_id_n, 1 as id_flag from kpi.tr_temp_daily_sso_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.lookup_name_v where temp.file_id_n = ? and temp.actor_type_n = 10 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_daily_sso_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;
1168_DAILY_JOIN_QUERY_2= select 1168 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(site.site_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 21 as instance_type_n, coalesce(temp.instance_key_v::numeric,0) as instance_id_n, temp.file_id_n, 1 as id_flag from kpi.tr_temp_daily_sso_aggr temp left join kpi.ms_site_master site on temp.actor_key_v = site.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.lookup_name_v where temp.file_id_n = ? and temp.actor_type_n = 12 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_daily_sso_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;  
1168_MONTHLY_JOIN_QUERY_1= select 1168 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 21 as instance_type_n, coalesce(temp.instance_key_v::numeric,0) as instance_id_n, temp.file_id_n, 1 as id_flag from kpi.tr_temp_daily_sso_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.lookup_name_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 10 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_daily_sso_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;
1168_MONTHLY_JOIN_QUERY_2= select 1168 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(site.site_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 21 as instance_type_n, coalesce(temp.instance_key_v::numeric,0) as instance_id_n, temp.file_id_n, 1 as id_flag from kpi.tr_temp_daily_sso_aggr temp left join kpi.ms_site_master site on temp.actor_key_v = site.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.lookup_name_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 12 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_daily_sso_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

1181_DAILY_JOIN_QUERY_1= select 1181 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 21 as instance_type_n, coalesce(temp.instance_key_v::numeric,0) as instance_id_n, temp.file_id_n, 1 as id_flag from kpi.tr_temp_uro_20k_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.lookup_name_v where temp.file_id_n = ? and temp.actor_type_n = 10 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_uro_20k_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;  
1181_DAILY_JOIN_QUERY_2= select 1181 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(site.site_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 21 as instance_type_n, coalesce(temp.instance_key_v::numeric,0) as instance_id_n, temp.file_id_n, 1 as id_flag from kpi.tr_temp_uro_20k_aggr temp left join kpi.ms_site_master site on temp.actor_key_v = site.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.lookup_name_v where temp.file_id_n = ? and temp.actor_type_n = 12 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_uro_20k_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;  
1181_MONTHLY_JOIN_QUERY_1= select 1181 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 21 as instance_type_n, coalesce(temp.instance_key_v::numeric,0) as instance_id_n, temp.file_id_n, 1 as id_flag from kpi.tr_temp_uro_20k_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.lookup_name_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 10 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_uro_20k_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;
1181_MONTHLY_JOIN_QUERY_2= select 1181 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(site.site_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 21 as instance_type_n, coalesce(temp.instance_key_v::numeric,0) as instance_id_n, temp.file_id_n, 1 as id_flag from kpi.tr_temp_uro_20k_aggr temp left join kpi.ms_site_master site on temp.actor_key_v = site.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.lookup_name_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 12 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_uro_20k_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;


1185_NOT_EXIST_QUERY={ "ACTOR": { "select": "select 15 as actor_type_n, a.actor_key_v from (select distinct actor_key_v from kpi.tr_temp_dssf_attendance_aggr where file_id_n = ?) a where a.actor_key_v not in (select actor_id_v from kpi.ms_actor_master where actor_type_n = 15)","insert":"insert into kpi.ms_actor_master(actor_type_n, actor_id_v) values (?, ?)","select-placeholders":1,"insert-placeholders":[{"1":"long"},{"2":"string"}]},"METRICS":{"select":"select a.metrics_key_v, a.metrics_key_v, 26 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from( select distinct metrics_key_v from kpi.tr_temp_dssf_attendance_aggr where file_id_n = ?) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 26)","insert":"insert into kpi.ms_metrics_master(metrics_name_v, description_v, metrics_type_n, ext_reference_id_v, definition_v) values (?, ?, ?, ?, ?)","select-placeholders":1,"insert-placeholders":[{"1":"string"},{"2":"string"},{"3":"long"},{"4":"string"},{"5":"string"}]}}


1185_DAILY_PRE_AGGR_QUERY= delete from kpi.tr_daily_dssf_attendance_aggr where day_id_n in (select distinct(id_n) from kpi.tr_temp_dssf_attendance_aggr where file_id_n = ?);
1185_MONTHLY_PRE_AGGR_QUERY= update kpi.tr_monthly_dssf_attendance_aggr as monthly set dimension_1_n = case when (coalesce(monthly.dimension_1_n,0) = 0) then monthly.dimension_1_n else (coalesce(monthly.dimension_1_n,0) - coalesce(daily.dimension_1_n,0)) end, dimension_2_n = case when (coalesce(monthly.dimension_2_n,0) = 0) then monthly.dimension_2_n else (coalesce(monthly.dimension_2_n,0) - coalesce(daily.dimension_2_n,0)) end, dimension_3_n = case when (coalesce(monthly.dimension_3_n,0) = 0) then monthly.dimension_3_n else (coalesce(monthly.dimension_3_n,0) - coalesce(daily.dimension_3_n,0)) end, dimension_4_n = case when (coalesce(monthly.dimension_4_n,0) = 0) then monthly.dimension_4_n else (coalesce(monthly.dimension_4_n,0) - coalesce(daily.dimension_4_n,0)) end, dimension_5_n = case when (coalesce(monthly.dimension_5_n,0) = 0) then monthly.dimension_5_n else (coalesce(monthly.dimension_5_n,0) - coalesce(daily.dimension_5_n,0)) end, dimension_6_n = case when (coalesce(monthly.dimension_6_n,0) = 0) then monthly.dimension_6_n else (coalesce(monthly.dimension_6_n,0) - coalesce(daily.dimension_6_n,0)) end, dimension_7_n = case when (coalesce(monthly.dimension_7_n,0) = 0) then monthly.dimension_7_n else (coalesce(monthly.dimension_7_n,0) - coalesce(daily.dimension_7_n,0)) end, dimension_8_n = case when (coalesce(monthly.dimension_8_n,0) = 0) then monthly.dimension_8_n else (coalesce(monthly.dimension_8_n,0) - coalesce(daily.dimension_8_n,0)) end, dimension_9_n = case when (coalesce(monthly.dimension_9_n,0) = 0) then monthly.dimension_9_n else (coalesce(monthly.dimension_9_n,0) - coalesce(daily.dimension_9_n,0)) end, dimension_10_n = case when (coalesce(monthly.dimension_10_n,0) = 0) then monthly.dimension_10_n else (coalesce(monthly.dimension_10_n,0) - coalesce(daily.dimension_10_n,0)) end, no_of_events_n = case when (coalesce(monthly.no_of_events_n,0) = 0) then monthly.no_of_events_n else (coalesce(monthly.no_of_events_n,0) - coalesce(daily.no_of_events_n,0)) end, last_updated_time_dt = now() from (select to_char(to_date(day_id_n::text,'yyyymmdd'),'yyyymm')::numeric as month_id_n, actor_type_n, actor_id_n, event_type_n, metrics_type_n, metrics_id_n, sum(dimension_1_n) as dimension_1_n, sum(dimension_2_n) as dimension_2_n, sum(dimension_3_n) as dimension_3_n, sum(dimension_4_n) as dimension_4_n, sum(dimension_5_n) as dimension_5_n, sum(dimension_6_n) as dimension_6_n, sum(dimension_7_n) as dimension_7_n, sum(dimension_8_n) as dimension_8_n, sum(dimension_9_n) as dimension_9_n, sum(dimension_10_n) as dimension_10_n, sum(no_of_events_n) as no_of_events_n, source_type_n, source_id_n, data_flag_n, instance_type_n, instance_id_n from kpi.tr_daily_dssf_attendance_aggr where day_id_n in (select distinct(id_n) from kpi.tr_temp_dssf_attendance_aggr where file_id_n = ?) group by month_id_n, actor_type_n, actor_id_n, event_type_n, event_type_n, metrics_type_n, metrics_id_n, source_type_n, source_id_n, data_flag_n, instance_type_n, instance_id_n ) as daily where monthly.month_id_n = daily.month_id_n and monthly.actor_type_n = daily.actor_type_n and monthly.actor_id_n = daily.actor_id_n and monthly.event_type_n = daily.event_type_n and monthly.metrics_type_n = daily.metrics_type_n and monthly.metrics_id_n = daily.metrics_id_n and monthly.source_type_n = daily.source_type_n and monthly.source_id_n = daily.source_id_n and monthly.data_flag_n = daily.data_flag_n and monthly.instance_type_n = daily.instance_type_n and monthly.instance_id_n = daily.instance_id_n;   
1185_CLEANUP_PRE_AGGR_QUERY= delete from kpi.tr_monthly_dssf_attendance_aggr where month_id_n in (select distinct(to_char(to_date(id_n::text,'yyyymmdd'),'yyyymm')::numeric) from kpi.tr_temp_dssf_attendance_aggr where file_id_n = ?) and (coalesce(dimension_1_n,0) = 0 and coalesce(dimension_2_n,0) = 0 and coalesce(dimension_3_n,0) = 0 and coalesce(dimension_4_n,0) = 0 and coalesce(dimension_5_n,0) = 0);

1185_DAILY_JOIN_QUERY_1= select 1185 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(promoter.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, coalesce(checkin.metrics_id_n, 0) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(clus.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, 1 as id_flag from kpi.tr_temp_dssf_attendance_aggr temp left join kpi.ms_actor_master promoter on temp.actor_type_n = promoter.actor_type_n and temp.actor_key_v = promoter.actor_id_v left join kpi.ms_lookup_master clus on clus.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 88) and temp.source_key_v = clus.lookup_name_v left join kpi.ms_metrics_master checkin on checkin.metrics_type_n = 26 and temp.metrics_key_v = checkin.ext_reference_id_v where temp.file_id_n = ? and temp.actor_type_n = 15 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_dssf_attendance_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;  
1185_MONTHLY_JOIN_QUERY_1= select 1185 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(promoter.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, coalesce(checkin.metrics_id_n, 0) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(clus.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, 1 as id_flag from kpi.tr_temp_dssf_attendance_aggr temp left join kpi.ms_actor_master promoter on temp.actor_type_n = promoter.actor_type_n and temp.actor_key_v = promoter.actor_id_v left join kpi.ms_lookup_master clus on clus.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 88) and temp.source_key_v = clus.lookup_name_v left join kpi.ms_metrics_master checkin on checkin.metrics_type_n = 26 and temp.metrics_key_v = checkin.ext_reference_id_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 15 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_dssf_attendance_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;
