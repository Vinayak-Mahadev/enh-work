#KPI DAILY & MONTHLY JOIN QUERIES..
1064_DAILY_JOIN_QUERY_1=SELECT 1064 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, coalesce(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, coalesce(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_revenue_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 34 ) LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 36 ) WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_org_transfer_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1064_MONTHLY_JOIN_QUERY_1=SELECT 1064 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_revenue_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 34 ) LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 36 ) INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_org_transfer_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1065_DAILY_JOIN_QUERY_1=SELECT 1065 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, temp.source_type_n, temp.source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_revenue_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 35 ) WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_indosat_transfer_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1065_MONTHLY_JOIN_QUERY_1=SELECT 1065 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, temp.source_type_n, temp.source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_revenue_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 35 ) INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_indosat_transfer_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n
#1065_DAILY_JOIN_QUERY_1=SELECT 1065 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dusr.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dusr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_revenue_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 35 ) LEFT JOIN kpi.ms_user_master dusr ON temp.source_key_v = dusr.operator_id_v WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_indosat_transfer_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
#1065_MONTHLY_JOIN_QUERY_1=SELECT 1065 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dusr.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dusr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_revenue_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 35 ) LEFT JOIN kpi.ms_user_master dusr ON temp.source_key_v = dusr.operator_id_v INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_indosat_transfer_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1066_DAILY_JOIN_QUERY_1=SELECT 1066 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n ), temp.actor_type_n ) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n ), temp.metrics_type_n ) as metrics_type_n, (select metrics_id_n[1] from kpi.mp_event_metric_mapping where event_type_n = 102) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n ), temp.source_type_n ) as source_type_n, COALESCE(dnm.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v ) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(temp.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v ) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dnm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v ) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_direct_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_network_master dnm ON temp.source_key_v = dnm.lacci_id_v WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_sale_revenue_lacci_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1066_MONTHLY_JOIN_QUERY_1=SELECT 1066 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n ), temp.actor_type_n ) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n ), temp.metrics_type_n ) as metrics_type_n, (select metrics_id_n[1] from kpi.mp_event_metric_mapping where event_type_n = 102) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n ), temp.source_type_n ) as source_type_n, COALESCE(dnm.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v ) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(temp.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v ) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dnm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v ) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_direct_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_network_master dnm ON temp.source_key_v = dnm.lacci_id_v INNER JOIN kpi.ms_day_master AS day_master ON (temp.id_n = day_master.day_id_n) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_sale_revenue_lacci_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1067_DAILY_JOIN_QUERY_1=SELECT 1067 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n ), temp.actor_type_n ) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n ), temp.metrics_type_n ) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n ), temp.source_type_n ) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v ) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v ) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v ) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_revenue_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 33 ) LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_sale_revenue_org_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1067_MONTHLY_JOIN_QUERY_1=SELECT 1067 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n ), temp.actor_type_n ) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n ), temp.metrics_type_n ) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n ), temp.source_type_n ) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v ) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v ) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v ) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_revenue_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 33 ) LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v INNER JOIN kpi.ms_day_master AS day_master ON (temp.id_n = day_master.day_id_n) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_sale_revenue_org_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1068_DAILY_JOIN_QUERY_1=SELECT 1068 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n ), temp.actor_type_n ) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n ), temp.metrics_type_n ) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n ), temp.source_type_n ) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n ), temp.instance_type_n ) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v ) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v ) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v ) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v ) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.metrics_name_v AND met.metrics_type_n = 13 AND met.status_n IN (1, 174) ) LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 31 ) WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_package_act_seller_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1068_MONTHLY_JOIN_QUERY_1=SELECT 1068 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n ), temp.actor_type_n ) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n ), temp.metrics_type_n ) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n ), temp.source_type_n ) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n ), temp.instance_type_n ) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v ) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v ) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v ) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v ) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.metrics_name_v AND met.metrics_type_n = 13 AND met.status_n IN (1, 174) ) LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 31 ) INNER JOIN kpi.ms_day_master AS day_master ON (temp.id_n = day_master.day_id_n) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_package_act_seller_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1069_DAILY_JOIN_QUERY_1=SELECT 1069 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n ), temp.actor_type_n ) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n ), temp.metrics_type_n ) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n ), temp.source_type_n ) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n ), temp.instance_type_n ) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v ) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v ) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v ) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v ) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.metrics_name_v AND met.metrics_type_n = 13 AND met.status_n IN (1, 174) ) LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 31 ) WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_package_act_buyer_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1069_MONTHLY_JOIN_QUERY_1=SELECT 1069 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n ), temp.actor_type_n ) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n ), temp.metrics_type_n ) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n ), temp.source_type_n ) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n ), temp.instance_type_n ) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v ) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v ) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v ) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v ) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.metrics_name_v AND met.metrics_type_n = 13 AND met.status_n IN (1, 174) ) LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 31 ) INNER JOIN kpi.ms_day_master AS day_master ON (temp.id_n = day_master.day_id_n) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_package_act_buyer_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1070_DAILY_JOIN_QUERY_1=SELECT 1070 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_revenue_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 37) left JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 40) WHERE temp.file_id_n = ? and temp.metrics_type_n = 37 ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) UNION ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) AS dimension_1_n, sum(result.dimension_2_n) AS dimension_2_n, sum(result.dimension_3_n) AS dimension_3_n, sum(result.dimension_4_n) dimension_4_n, sum(result.dimension_5_n) AS dimension_5_n, sum(result.dimension_6_n) AS dimension_6_n, sum(result.dimension_7_n) AS dimension_7_n, sum(result.dimension_8_n) AS dimension_8_n, sum(result.dimension_9_n) AS dimension_9_n, sum(result.dimension_10_n) AS dimension_10_n, sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_revenue_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 39) LEFT JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 40) WHERE temp.file_id_n = ? and temp.metrics_type_n = 39 ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) ) temp1 LEFT JOIN kpi.tr_daily_usage_metrics_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1070_MONTHLY_JOIN_QUERY_1=SELECT 1070 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_revenue_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 37) left JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 40) INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 and temp.metrics_type_n = 37 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) UNION ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) AS dimension_1_n, sum(result.dimension_2_n) AS dimension_2_n, sum(result.dimension_3_n) AS dimension_3_n, sum(result.dimension_4_n) dimension_4_n, sum(result.dimension_5_n) AS dimension_5_n, sum(result.dimension_6_n) AS dimension_6_n, sum(result.dimension_7_n) AS dimension_7_n, sum(result.dimension_8_n) AS dimension_8_n, sum(result.dimension_9_n) AS dimension_9_n, sum(result.dimension_10_n) AS dimension_10_n, sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_revenue_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_revenue_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 39) LEFT JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 40) INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 and temp.metrics_type_n = 39 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) ) temp1 LEFT JOIN kpi.tr_monthly_usage_metrics_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1071_DAILY_JOIN_QUERY_1=SELECT 1071 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n ), temp.actor_type_n ) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n ), temp.metrics_type_n ) as metrics_type_n, (select metrics_id_n[1] from kpi.mp_event_metric_mapping where event_type_n = 103) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n ), temp.source_type_n ) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v ) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(temp.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v ) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v ) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_direct_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_subscriber_event_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1071_MONTHLY_JOIN_QUERY_1=SELECT 1071 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n ), temp.actor_type_n ) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE( ( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n ), temp.metrics_type_n ) as metrics_type_n, (select metrics_id_n[1] from kpi.mp_event_metric_mapping where event_type_n = 103) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE( ( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n ), temp.source_type_n ) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v ) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(temp.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v ) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v ) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_direct_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v INNER JOIN kpi.ms_day_master AS day_master ON (temp.id_n = day_master.day_id_n) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_subscriber_event_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1075_DAILY_JOIN_QUERY_1=SELECT 1075 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, 13 as data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, 1 as actor_type_n, COALESCE(sorg.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 109 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, temp.source_type_n, temp.source_id_n, temp.data_flag_n, temp.instance_key_v, 33 as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v ) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp LEFT JOIN kpi.ms_org_master sorg ON temp.actor_key_v = sorg.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 33 ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_mobo_transaction_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1075_MONTHLY_JOIN_QUERY_1=SELECT 1075 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, 13 as data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, 1 as actor_type_n, COALESCE(sorg.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v as metrics_key_v, 21 as metrics_type_n, 109 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, temp.source_type_n, temp.source_id_n, temp.data_flag_n, temp.instance_key_v, 33 as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row( 'tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v ) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp LEFT JOIN kpi.ms_org_master sorg ON temp.actor_key_v = sorg.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 33 ) INNER JOIN kpi.ms_day_master AS day_master ON (temp.id_n = day_master.day_id_n) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_mobo_transaction_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n
#1075_DAILY_JOIN_QUERY_1=SELECT '1075_1'::character varying as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, 11 as data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(usr.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, split_part(temp.metrics_key_v, ',', 1) as metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = 46), 46) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(usr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || split_part(temp.metrics_key_v, ',', 1)) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp LEFT JOIN kpi.ms_user_master usr ON temp.actor_key_v = usr.operator_id_v LEFT JOIN kpi.ms_metrics_master met ON ( split_part(temp.metrics_key_v, ',', 1) = met.metrics_name_v AND met.metrics_type_n = 11 AND met.status_n IN ( 1, 174 ) ) LEFT JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 33 ) WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_mobo_transaction_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
#1075_DAILY_JOIN_QUERY_2=SELECT '1075_2'::character varying as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, 13 as data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(usr.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, split_part(temp.metrics_key_v, ',', 2) as metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = 43), 43) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(usr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || split_part(temp.metrics_key_v, ',', 2)) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp LEFT JOIN kpi.ms_user_master usr ON temp.actor_key_v = usr.operator_id_v LEFT JOIN kpi.ms_metrics_master met ON ( split_part(temp.metrics_key_v, ',', 2) = met.metrics_name_v AND met.metrics_type_n = 13 AND met.status_n IN ( 1, 174 ) ) LEFT JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 33 ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_mobo_transaction_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
#1075_DAILY_JOIN_QUERY_3=SELECT '1075_3'::character varying as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, 0 as data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(usr.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, split_part(temp.metrics_key_v, ',', 3) as metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = 33), 33) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(usr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || split_part(temp.metrics_key_v, ',', 3)) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp LEFT JOIN kpi.ms_user_master usr ON temp.actor_key_v = usr.operator_id_v LEFT JOIN kpi.ms_metrics_master met ON ( split_part(temp.metrics_key_v, ',', 3) = met.ext_reference_id_v AND met.metrics_type_n = 33) LEFT JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 33 ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_mobo_transaction_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
#1075_DAILY_JOIN_QUERY_4=SELECT '1075_4'::character varying as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, 0 as data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(usr.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, split_part(temp.metrics_key_v, ',', 4) as metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = 46), 46) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(usr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || split_part(temp.metrics_key_v, ',', 4)) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp LEFT JOIN kpi.ms_user_master usr ON temp.actor_key_v = usr.operator_id_v LEFT JOIN kpi.ms_metrics_master met ON ( split_part(temp.metrics_key_v, ',', 4) = met.metrics_name_v AND met.metrics_type_n = 11 AND met.status_n IN ( 1, 174 ) ) LEFT JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 33 ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_mobo_transaction_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
#1075_DAILY_JOIN_QUERY_5=SELECT '1075_5'::character varying as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, 0 as data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(usr.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, split_part(temp.metrics_key_v, ',', 5) as metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = 43), 43) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(usr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || split_part(temp.metrics_key_v, ',', 5)) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp LEFT JOIN kpi.ms_user_master usr ON temp.actor_key_v = usr.operator_id_v LEFT JOIN kpi.ms_metrics_master met ON ( split_part(temp.metrics_key_v, ',', 5) = met.metrics_name_v AND met.metrics_type_n = 13 AND met.status_n IN ( 1, 174 ) ) LEFT JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 33 ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_mobo_transaction_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
#1075_MONTHLY_JOIN_QUERY_1=SELECT '1075_1'::character varying as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, 11 as data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(usr.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, split_part(temp.metrics_key_v, ',', 1) as metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = 46), 46) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(usr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || split_part(temp.metrics_key_v, ',', 1)) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp LEFT JOIN kpi.ms_user_master usr ON temp.actor_key_v = usr.operator_id_v LEFT JOIN kpi.ms_metrics_master met ON ( split_part(temp.metrics_key_v, ',', 1) = met.metrics_name_v AND met.metrics_type_n = 11 AND met.status_n IN ( 1, 174 ) ) LEFT JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 33 ) INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_mobo_transaction_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n
#1075_MONTHLY_JOIN_QUERY_2=SELECT '1075_2'::character varying as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, 13 as data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(usr.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, split_part(temp.metrics_key_v, ',', 2) as metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = 43), 43) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(usr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || split_part(temp.metrics_key_v, ',', 2)) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp LEFT JOIN kpi.ms_user_master usr ON temp.actor_key_v = usr.operator_id_v LEFT JOIN kpi.ms_metrics_master met ON ( split_part(temp.metrics_key_v, ',', 2) = met.metrics_name_v AND met.metrics_type_n = 13 AND met.status_n IN ( 1, 174 ) ) LEFT JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 33 ) INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_mobo_transaction_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n
#1075_MONTHLY_JOIN_QUERY_3=SELECT '1075_3'::character varying as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, 0 as data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(usr.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, split_part(temp.metrics_key_v, ',', 3) as metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = 33), 33) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(usr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || split_part(temp.metrics_key_v, ',', 3)) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp LEFT JOIN kpi.ms_user_master usr ON temp.actor_key_v = usr.operator_id_v LEFT JOIN kpi.ms_metrics_master met ON ( split_part(temp.metrics_key_v, ',', 3) = met.ext_reference_id_v AND met.metrics_type_n = 33) LEFT JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 33 ) INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_mobo_transaction_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n
#1075_MONTHLY_JOIN_QUERY_4=SELECT '1075_4'::character varying as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, 0 as data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(usr.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, split_part(temp.metrics_key_v, ',', 4) as metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = 46), 46) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(usr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || split_part(temp.metrics_key_v, ',', 4)) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp LEFT JOIN kpi.ms_user_master usr ON temp.actor_key_v = usr.operator_id_v LEFT JOIN kpi.ms_metrics_master met ON ( split_part(temp.metrics_key_v, ',', 4) = met.metrics_name_v AND met.metrics_type_n = 11 AND met.status_n IN ( 1, 174 ) ) LEFT JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 33 ) INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_mobo_transaction_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n
#1075_MONTHLY_JOIN_QUERY_5=SELECT '1075_5'::character varying as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, 0 as data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(usr.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, split_part(temp.metrics_key_v, ',', 5) as metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = 43), 43) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(usr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || split_part(temp.metrics_key_v, ',', 5)) WHEN temp.source_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_trans_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp LEFT JOIN kpi.ms_user_master usr ON temp.actor_key_v = usr.operator_id_v LEFT JOIN kpi.ms_metrics_master met ON ( split_part(temp.metrics_key_v, ',', 5) = met.metrics_name_v AND met.metrics_type_n = 13 AND met.status_n IN ( 1, 174 ) ) LEFT JOIN kpi.ms_org_master org ON temp.source_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 33 ) INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_mobo_transaction_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1076_DAILY_JOIN_QUERY_1=SELECT 1076 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 30 ) LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 38 ) WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_reload_seller_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1076_MONTHLY_JOIN_QUERY_1=SELECT 1076 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 30 ) LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 38 ) INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_reload_seller_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1077_DAILY_JOIN_QUERY_1=SELECT 1077 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, temp.source_type_n, temp.source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 30 ) LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 38 ) WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_reload_buyer_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1077_MONTHLY_JOIN_QUERY_1=SELECT 1077 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, temp.source_type_n, temp.source_id_n, temp.data_flag_n, temp.instance_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, COALESCE(imet.metrics_id_n, 0) AS instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.instance_key_v IS NOT NULL AND COALESCE(imet.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.ms_network_master nm ON temp.actor_key_v = nm.lacci_id_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 30 ) LEFT JOIN kpi.ms_metrics_master imet ON ( temp.instance_key_v = imet.ext_reference_id_v AND imet.metrics_type_n = 38 ) INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_reload_buyer_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1078_DAILY_JOIN_QUERY_1=SELECT 1078 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(am.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dusr.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(am.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dusr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.tr_msisdn_product_mapping mp on temp.metrics_key_v = mp.msisdn_v LEFT JOIN kpi.ms_actor_master am ON (am.actor_type_n = 7 and am.actor_id_v = temp.actor_key_v) LEFT JOIN kpi.ms_metrics_master met ON ( mp.prd_id_v = met.ext_metrics_id_v AND met.metrics_type_n = 13) LEFT JOIN kpi.ms_user_master dusr ON temp.source_key_v = dusr.operator_id_v WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_usage_customer_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1078_MONTHLY_JOIN_QUERY_1=SELECT 1078 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(am.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dusr.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(am.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dusr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.tr_msisdn_product_mapping mp on temp.metrics_key_v = mp.msisdn_v LEFT JOIN kpi.ms_actor_master am ON (am.actor_type_n = 7 and am.actor_id_v = temp.actor_key_v) LEFT JOIN kpi.ms_metrics_master met ON ( mp.prd_id_v = met.ext_metrics_id_v AND met.metrics_type_n = 13) LEFT JOIN kpi.ms_user_master dusr ON temp.source_key_v = dusr.operator_id_v INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_usage_customer_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1079_DAILY_JOIN_QUERY_1=SELECT 1079 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(am.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dusr.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(am.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dusr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.tr_msisdn_product_mapping mp on temp.actor_key_v = mp.msisdn_v LEFT JOIN kpi.ms_actor_master am ON (am.actor_type_n = 7 and am.actor_id_v = mp.msisdn_v) LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.metrics_name_v AND met.metrics_type_n = 13 AND status_n IN ( 1, 174 ) ) LEFT JOIN kpi.ms_user_master dusr ON temp.source_key_v = dusr.operator_id_v WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_addon_customer_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1079_MONTHLY_JOIN_QUERY_1=SELECT 1079 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(am.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dusr.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(am.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dusr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.tr_msisdn_product_mapping mp on temp.actor_key_v = mp.msisdn_v LEFT JOIN kpi.ms_actor_master am ON (am.actor_type_n = 7 and am.actor_id_v = mp.msisdn_v) LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.metrics_name_v AND met.metrics_type_n = 13 AND status_n IN ( 1, 174 ) ) LEFT JOIN kpi.ms_user_master dusr ON temp.source_key_v = dusr.operator_id_v INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_addon_customer_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1080_DAILY_JOIN_QUERY_1=SELECT 1080 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(am.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dusr.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(am.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dusr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.tr_msisdn_product_mapping mp on temp.metrics_key_v = mp.msisdn_v LEFT JOIN kpi.ms_actor_master am ON (am.actor_type_n = 7 and am.actor_id_v = temp.actor_key_v) LEFT JOIN kpi.ms_metrics_master met ON ( mp.prd_id_v = met.ext_metrics_id_v AND met.metrics_type_n = 13) LEFT JOIN kpi.ms_user_master dusr ON temp.source_key_v = dusr.operator_id_v WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_reload_customer_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1080_MONTHLY_JOIN_QUERY_1=SELECT 1080 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(am.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dusr.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(am.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dusr.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_aggr temp LEFT JOIN kpi.tr_msisdn_product_mapping mp on temp.metrics_key_v = mp.msisdn_v LEFT JOIN kpi.ms_actor_master am ON (am.actor_type_n = 7 and am.actor_id_v = temp.actor_key_v) LEFT JOIN kpi.ms_metrics_master met ON ( mp.prd_id_v = met.ext_metrics_id_v AND met.metrics_type_n = 13) LEFT JOIN kpi.ms_user_master dusr ON temp.source_key_v = dusr.operator_id_v INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_reload_customer_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1081_DAILY_JOIN_QUERY_1=SELECT 1081 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, (select metrics_id_n[1] from kpi.mp_event_metric_mapping where event_type_n = 110) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(temp.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_direct_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v WHERE temp.file_id_n = ? ) result where result.id_flag = 1 GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_reload_sellinout_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n
1081_MONTHLY_JOIN_QUERY_1=SELECT 1081 as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL) THEN NULL ELSE ( COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0) ) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0) ) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0) ) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0) ) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0) ) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0) ) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0) ) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0) ) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE ( COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0) ) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT day_master.month_id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, (select metrics_id_n[1] from kpi.mp_event_metric_mapping where event_type_n = 110) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(temp.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_direct_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_direct_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v INNER JOIN kpi.ms_day_master AS day_master ON ( temp.id_n = day_master.day_id_n ) WHERE temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_reload_sellinout_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n

1082_DAILY_JOIN_QUERY_1=SELECT 1082 as interface_id_n, temp1.temp_id_n, temp1.id_n, day.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, temp1.dimension_1_n AS dimension_1_n, temp1.dimension_2_n AS dimension_2_n, temp1.dimension_3_n AS dimension_3_n, temp1.dimension_4_n AS dimension_4_n, temp1.dimension_5_n AS dimension_5_n, temp1.dimension_6_n AS dimension_6_n, temp1.dimension_7_n AS dimension_7_n, temp1.dimension_8_n AS dimension_8_n, temp1.dimension_9_n AS dimension_9_n, temp1.dimension_10_n AS dimension_10_n, temp1.no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM( SELECT result.temp_id_n, result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.dimension_1_n, result.dimension_2_n, result.dimension_3_n, result.dimension_4_n, result.dimension_5_n, result.dimension_6_n, result.dimension_7_n, result.dimension_8_n, result.dimension_9_n, result.dimension_10_n, result.no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM ( SELECT temp.temp_id_n, temp.id_n, temp.actor_key_v, COALESCE(al.reference_type_n, temp.actor_type_n) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(ml.reference_type_n, temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(sl.reference_type_n, temp.source_type_n) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_orgbal_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_orgbal_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_orgbal_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_orgbal_aggr temp LEFT JOIN kpi.ms_actor_lookup_master al ON temp.actor_type_n = al.actor_type_n LEFT JOIN kpi.ms_metrics_lookup_master ml ON ml.metrics_type_n = temp.metrics_type_n LEFT JOIN kpi.ms_actor_lookup_master sl ON sl.actor_type_n = temp.source_type_n LEFT JOIN kpi.ms_org_master org ON (temp.actor_key_v = org.ref_code_v and org.status_n = 174) LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 34) LEFT JOIN kpi.ms_org_master dorg ON (temp.source_key_v = dorg.ref_code_v and dorg.status_n = 174) WHERE temp.file_id_n = ? order by temp.temp_id_n) result where result.id_flag = 1 ) temp1 LEFT JOIN kpi.tr_daily_org_balance_aggr day ON temp1.id_n = day.day_id_n AND temp1.actor_type_n = day.actor_type_n AND temp1.actor_id_n = day.actor_id_n AND temp1.event_type_n = day.event_type_n AND temp1.metrics_type_n = day.metrics_type_n AND temp1.metrics_id_n = day.metrics_id_n AND temp1.source_type_n = day.source_type_n AND temp1.source_id_n = day.source_id_n AND temp1.data_flag_n = day.data_flag_n AND temp1.instance_type_n = day.instance_type_n AND temp1.instance_id_n = day.instance_id_n
#1082_DAILY_JOIN_QUERY=SELECT temp1.temp_id_n, temp1.id_n, day.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, temp1.dimension_1_n AS dimension_1_n, temp1.dimension_2_n AS dimension_2_n, temp1.dimension_3_n AS dimension_3_n, temp1.dimension_4_n AS dimension_4_n, temp1.dimension_5_n AS dimension_5_n, temp1.dimension_6_n AS dimension_6_n, temp1.dimension_7_n AS dimension_7_n, temp1.dimension_8_n AS dimension_8_n, temp1.dimension_9_n AS dimension_9_n, temp1.dimension_10_n AS dimension_10_n, temp1.no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM(SELECT a.* FROM kpi.tr_temp_upload_metrics_orgbal_aggr_st a, (SELECT id_n, actor_type_n, actor_id_n, event_type_n, metrics_type_n, metrics_id_n, source_type_n, source_id_n, data_flag_n, instance_type_n, instance_id_n, max(temp_id_n) id FROM kpi.tr_temp_upload_metrics_orgbal_aggr_st WHERE file_id_n = ? AND status_flag_n = 1 GROUP BY id_n, actor_type_n, actor_id_n, event_type_n, metrics_type_n, metrics_id_n, source_type_n, source_id_n, data_flag_n, instance_type_n, instance_id_n) b WHERE a.temp_id_n = b.id ) temp1 LEFT JOIN kpi.tr_daily_upload_metrics_aggr day ON temp1.id_n = day.day_id_n AND temp1.actor_type_n = day.actor_type_n AND temp1.actor_id_n = day.actor_id_n AND temp1.event_type_n = day.event_type_n AND temp1.metrics_type_n = day.metrics_type_n AND temp1.metrics_id_n = day.metrics_id_n AND temp1.source_type_n = day.source_type_n AND temp1.source_id_n = day.source_id_n AND temp1.data_flag_n = day.data_flag_n AND temp1.instance_type_n = day.instance_type_n AND temp1.instance_id_n = day.instance_id_n

#1082_INNER_QUERY=insert into kpi.tr_temp_upload_metrics_orgbal_aggr_st (SELECT result.temp_id_n, result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.dimension_1_n, result.dimension_2_n, result.dimension_3_n, result.dimension_4_n, result.dimension_5_n, result.dimension_6_n, result.dimension_7_n, result.dimension_8_n, result.dimension_9_n, result.dimension_10_n, result.no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.id_flag, result.file_id_n FROM( SELECT temp.temp_id_n, temp.id_n, temp.actor_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, COALESCE(org.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, temp.metrics_key_v, COALESCE(( select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, COALESCE(met.metrics_id_n, kpi.Insert_analytics_aggregation_metric(temp.metrics_type_n, temp.metrics_key_v)) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, COALESCE(( select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, COALESCE(dorg.aggregation_id_n, 0) AS source_id_n, temp.data_flag_n, temp.instance_key_v, temp.instance_type_n, temp.instance_id_n, temp.file_id_n, CASE WHEN temp.actor_key_v IS NOT NULL AND COALESCE(org.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_orgbal_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, kpi.Insert_analytics_aggregation_metric(temp.metrics_type_n, temp.metrics_key_v)) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_orgbal_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) WHEN temp.source_key_v IS NOT NULL AND COALESCE(dorg.aggregation_id_n, 0) = 0 THEN kpi.update_analytics_failed_row('tr_temp_upload_metrics_orgbal_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_orgbal_aggr temp LEFT JOIN kpi.ms_org_master org ON temp.actor_key_v = org.ref_code_v LEFT JOIN kpi.ms_metrics_master met ON ( temp.metrics_key_v = met.ext_reference_id_v AND met.metrics_type_n = 34) LEFT JOIN kpi.ms_org_master dorg ON temp.source_key_v = dorg.ref_code_v WHERE temp.file_id_n = ?) result where result.id_flag = 1)

#HADOOP KPI DAILY & MONTHLY JOIN QUERIES:
#1166 - INTHDP002 - Primary MOBO
1166_DAILY_JOIN_QUERY_1=select 1166 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(mpc.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, 0 as source_type_n, 0 as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(mpc.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_primary_mobo_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) else 1 end as id_flag from kpi.tr_temp_primary_mobo_aggr as temp left join kpi.ms_org_master mpc on temp.actor_key_v = mpc.ref_code_v where temp.file_id_n = ? ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_primary_mobo_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;
1166_MONTHLY_JOIN_QUERY_1=select 1166 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(mpc.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, 0 as source_type_n, 0 as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(mpc.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_primary_mobo_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) else 1 end as id_flag from kpi.tr_temp_primary_mobo_aggr as temp left join kpi.ms_org_master mpc on temp.actor_key_v = mpc.ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_primary_mobo_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

#1167 - INTHDP003 - Secondary MOBO
1167_DAILY_JOIN_QUERY_1=select 1167 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(mpc.aggregation_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_secondary_mobo_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(mpc.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_secondary_mobo_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_secondary_mobo_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_org_master mpc on temp.source_key_v = mpc.ref_code_v where temp.file_id_n = ? ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_secondary_mobo_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;
1167_MONTHLY_JOIN_QUERY_1= select 1167 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(mpc.aggregation_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_secondary_mobo_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(mpc.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_secondary_mobo_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_secondary_mobo_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_org_master mpc on temp.source_key_v = mpc.ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_secondary_mobo_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

#1168 - INTHDP004 - MOBII Daily SSO 
#(1)
1168_DAILY_JOIN_QUERY_1=select 1168 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_daily_sso_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_daily_sso_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_daily_sso_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v where temp.file_id_n = ? and temp.actor_type_n = 10 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_daily_sso_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n; 
1168_MONTHLY_JOIN_QUERY_1=select 1168 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_daily_sso_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_daily_sso_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_daily_sso_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 10 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_daily_sso_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n; 

#(2)
1168_DAILY_JOIN_QUERY_2=select 1168 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(site.site_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_daily_sso_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_daily_sso_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_daily_sso_aggr temp left join kpi.ms_site_master site on temp.actor_key_v = site.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v where temp.file_id_n = ? and temp.actor_type_n = 12 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_daily_sso_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n; 
1168_MONTHLY_JOIN_QUERY_2=select 1168 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(site.site_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_daily_sso_aggr', temp.temp_id_n, 'actor_field%Source mapping not found for actor_field : ' || temp.actor_key_v) when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_daily_sso_aggr', temp.temp_id_n, 'source_field%Actor mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_daily_sso_aggr temp left join kpi.ms_site_master site on temp.actor_key_v = site.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 12 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_daily_sso_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n; 
 
#1169 - INTHDP005 - MOBII RGU-GA Injection
#(1)
1169_DAILY_JOIN_QUERY_1=select 1169 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, coalesce(met.metrics_id_n, 0) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_rguga_injection_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.metrics_key_v is not null and coalesce(met.metrics_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_rguga_injection_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_rguga_injection_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_rguga_injection_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_metrics_master met on temp.metrics_key_v = met.ext_reference_id_v and met.metrics_type_n = 24 left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v where temp.file_id_n = ? and temp.actor_type_n = 10 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_rguga_injection_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n; 
1169_MONTHLY_JOIN_QUERY_1=select 1169 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, coalesce(met.metrics_id_n, 0) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_rguga_injection_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.metrics_key_v is not null and coalesce(met.metrics_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_rguga_injection_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_rguga_injection_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_rguga_injection_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_metrics_master met on temp.metrics_key_v = met.ext_reference_id_v and met.metrics_type_n = 24 left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 10 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_rguga_injection_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n; 

#(2)
1169_DAILY_JOIN_QUERY_2=select 1169 AS interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(site.site_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, coalesce(met.metrics_id_n, 0) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_rguga_injection_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.metrics_key_v is not null and coalesce(met.metrics_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_rguga_injection_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_rguga_injection_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_rguga_injection_aggr temp left join kpi.ms_site_master site on temp.actor_key_v = site.ref_code_v left join kpi.ms_metrics_master met on temp.metrics_key_v = met.ext_reference_id_v and met.metrics_type_n = 24 left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v where temp.file_id_n = ? and temp.actor_type_n = 12 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_rguga_injection_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n; 
1169_MONTHLY_JOIN_QUERY_2=select 1169 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(site.site_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, coalesce(met.metrics_id_n, 0) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_rguga_injection_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.metrics_key_v is not null and coalesce(met.metrics_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_rguga_injection_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_rguga_injection_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_rguga_injection_aggr temp left join kpi.ms_site_master site on temp.actor_key_v = site.ref_code_v left join kpi.ms_metrics_master met on temp.metrics_key_v = met.ext_reference_id_v and met.metrics_type_n = 24 left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 12 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_rguga_injection_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n; 
 
#1170 - INTHDP006 - Tertiary Sales
#(1)
1170_DAILY_JOIN_QUERY_1=select 1170 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_tertiary_sales_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_tertiary_sales_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_tertiary_sales_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v where temp.file_id_n = ? and temp.actor_type_n = 10 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_tertiary_sales_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n; 
1170_MONTHLY_JOIN_QUERY_1=select 1170 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_tertiary_sales_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_tertiary_sales_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_tertiary_sales_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 10 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_tertiary_sales_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n; 

#(2)
1170_DAILY_JOIN_QUERY_2=select 1170 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(site.site_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_tertiary_sales_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_tertiary_sales_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_tertiary_sales_aggr temp left join kpi.ms_site_master site on temp.actor_key_v = site.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v where temp.file_id_n = ? and temp.actor_type_n = 12 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_tertiary_sales_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n; 
1170_MONTHLY_JOIN_QUERY_2=select 1170 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(site.site_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_tertiary_sales_aggr', temp.temp_id_n, 'actor_field%Source mapping not found for actor_field : ' || temp.actor_key_v) when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_tertiary_sales_aggr', temp.temp_id_n, 'source_field%Actor mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_tertiary_sales_aggr temp left join kpi.ms_site_master site on temp.actor_key_v = site.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 12 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_tertiary_sales_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n; 

#1171 - INTHDP007 - Organization MOBO Balance
1171_DAILY_JOIN_QUERY_1=select 1171 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, 0 as source_type_n, 0 as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_closing_balance_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) else 1 end as id_flag from kpi.tr_temp_closing_balance_aggr as temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v where temp.file_id_n = ? ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_closing_balance_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;
1171_MONTHLY_JOIN_QUERY_1=select 1171 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, 0 as source_type_n, 0 as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_closing_balance_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) else 1 end as id_flag from kpi.tr_temp_closing_balance_aggr as temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_closing_balance_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

#1172 - INTHDP008 - Prepaid Service Revenue
1172_DAILY_JOIN_QUERY_1=select 1172 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(micro.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, coalesce(met.metrics_id_n, 0) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(site.site_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_total_usage_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.metrics_key_v is not null and coalesce(met.metrics_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_total_usage_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_total_usage_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_total_usage_aggr temp left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.actor_key_v = micro.ext_ref_code_v left join kpi.ms_metrics_master met on temp.metrics_key_v = met.ext_reference_id_v and met.metrics_type_n = 25 left join kpi.ms_site_master site on temp.source_key_v = site.ref_code_v where temp.file_id_n = ? ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_total_usage_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;
1172_MONTHLY_JOIN_QUERY_1=select 1172 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(micro.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, coalesce(met.metrics_id_n, 0) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(site.site_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_total_usage_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.metrics_key_v is not null and coalesce(met.metrics_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_total_usage_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_total_usage_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_total_usage_aggr temp left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.actor_key_v = micro.ext_ref_code_v left join kpi.ms_metrics_master met on temp.metrics_key_v = met.ext_reference_id_v and met.metrics_type_n = 25 left join kpi.ms_site_master site on temp.source_key_v = site.ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_total_usage_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

#1173 - INTHDP009 - MOBO Usage Revenue
1173_DAILY_JOIN_QUERY_1=select 1173 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(micro.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(site.site_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_mobo_usage_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_mobo_usage_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_mobo_usage_aggr temp left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.actor_key_v = micro.ext_ref_code_v left join kpi.ms_site_master site on temp.source_key_v = site.ref_code_v where temp.file_id_n = ? ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_mobo_usage_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;
1173_MONTHLY_JOIN_QUERY_1=select 1173 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(micro.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(site.site_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_mobo_usage_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_mobo_usage_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_mobo_usage_aggr temp left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.actor_key_v = micro.ext_ref_code_v left join kpi.ms_site_master site on temp.source_key_v = site.ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_mobo_usage_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

#1174 - INTHDP010 - Acquisition Revenue
1174_DAILY_JOIN_QUERY_1=select 1174 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(micro.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(site.site_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_total_rguga_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_total_rguga_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_total_rguga_aggr temp left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.actor_key_v = micro.ext_ref_code_v left join kpi.ms_site_master site on temp.source_key_v = site.ref_code_v where temp.file_id_n = ? ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_total_rguga_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;
1174_MONTHLY_JOIN_QUERY_1= select 1174 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(micro.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(site.site_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_total_rguga_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_total_rguga_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_total_rguga_aggr temp left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.actor_key_v = micro.ext_ref_code_v left join kpi.ms_site_master site on temp.source_key_v = site.ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_total_rguga_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

#1175 - INTHDP011 - Low revenue Sites
1175_DAILY_JOIN_QUERY_1=select 1175 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(micro.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, coalesce(met.metrics_id_n, 0) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(site.site_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_low_revenue_site_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.metrics_key_v is not null and coalesce(met.metrics_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_low_revenue_site_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_low_revenue_site_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_low_revenue_site_aggr temp left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.actor_key_v = micro.ext_ref_code_v left join kpi.ms_metrics_master met on temp.metrics_key_v = met.ext_reference_id_v and met.metrics_type_n = 23 left join kpi.ms_site_master site on temp.source_key_v = site.ref_code_v where temp.file_id_n = ? ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_low_revenue_site_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;
1175_MONTHLY_JOIN_QUERY_1=select 1175 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(micro.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, coalesce(met.metrics_id_n, 0) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(site.site_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_low_revenue_site_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.metrics_key_v is not null and coalesce(met.metrics_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_low_revenue_site_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_low_revenue_site_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_low_revenue_site_aggr temp left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.actor_key_v = micro.ext_ref_code_v left join kpi.ms_metrics_master met on temp.metrics_key_v = met.ext_reference_id_v and met.metrics_type_n = 23 left join kpi.ms_site_master site on temp.source_key_v = site.ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_low_revenue_site_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

#1176 - INTHDP012 - Sites with RGU-GA
1176_DAILY_JOIN_QUERY_1=select 1176 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(micro.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(site.site_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_site_rguga_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_site_rguga_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_site_rguga_aggr temp left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.actor_key_v = micro.ext_ref_code_v left join kpi.ms_site_master site on temp.source_key_v = site.ref_code_v where temp.file_id_n = ? ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_site_rguga_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;
1176_MONTHLY_JOIN_QUERY_1=select 1176 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(micro.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(site.site_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_site_rguga_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_site_rguga_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_site_rguga_aggr temp left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.actor_key_v = micro.ext_ref_code_v left join kpi.ms_site_master site on temp.source_key_v = site.ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_site_rguga_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

#1177 - INTHDP013 - Cross Selling Cluster Reload
1177_DAILY_JOIN_QUERY_1=select 1177 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(clus.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, coalesce(met.metrics_id_n, 0) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, 0 as source_type_n, 0 as source_id_n, temp.data_flag_n, temp.instance_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, coalesce(ins.metrics_id_n, 0) as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(clus.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_cross_reload_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.metrics_key_v is not null and coalesce(met.metrics_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_cross_reload_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) when temp.instance_key_v is not null and coalesce(ins.metrics_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_cross_reload_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) else 1 end as id_flag from kpi.tr_temp_cross_reload_aggr temp left join kpi.ms_lookup_master clus on clus.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 88) and temp.actor_key_v = clus.ext_ref_code_v left join kpi.ms_metrics_master met on temp.metrics_key_v = met.ext_reference_id_v and met.metrics_type_n = 23 left join kpi.ms_metrics_master ins on temp.instance_key_v = ins.ext_reference_id_v and ins.metrics_type_n = 22 where temp.file_id_n = ? ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_cross_reload_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;
1177_MONTHLY_JOIN_QUERY_1=select 1177 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(clus.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.metrics_type_n), temp.metrics_type_n) as metrics_type_n, coalesce(met.metrics_id_n, 0) as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, 0 as source_type_n, 0 as source_id_n, temp.data_flag_n, temp.instance_key_v, coalesce((select reference_type_n from kpi.ms_metrics_lookup_master where metrics_type_n = temp.instance_type_n), temp.instance_type_n) as instance_type_n, coalesce(ins.metrics_id_n, 0) as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(clus.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_cross_reload_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.metrics_key_v is not null and coalesce(met.metrics_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_cross_reload_aggr', temp.temp_id_n, 'metric_field%Metric mapping not found for metric_field : ' || temp.metrics_key_v) when temp.instance_key_v is not null and coalesce(ins.metrics_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_cross_reload_aggr', temp.temp_id_n, 'instance_field%Instance mapping not found for instance_field : ' || temp.instance_key_v) else 1 end as id_flag from kpi.tr_temp_cross_reload_aggr temp left join kpi.ms_lookup_master clus on clus.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 88) and temp.actor_key_v = clus.ext_ref_code_v left join kpi.ms_metrics_master met on temp.metrics_key_v = met.ext_reference_id_v and met.metrics_type_n = 23 left join kpi.ms_metrics_master ins on temp.instance_key_v = ins.ext_reference_id_v and ins.metrics_type_n = 22 inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_cross_reload_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

#1178 - INTHDP014 - Cross Selling Area Data Package
1178_DAILY_JOIN_QUERY_1=select 1178 AS interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(clus.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, 0 as source_type_n, 0 as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(clus.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_cross_data_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) else 1 end as id_flag from kpi.tr_temp_cross_data_aggr temp left join kpi.ms_lookup_master clus on clus.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 88) and temp.actor_key_v = clus.ext_ref_code_v where temp.file_id_n = ? ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_cross_data_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n;
1178_MONTHLY_JOIN_QUERY_1=select 1178 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(clus.lookup_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, 0 as source_type_n, 0 as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(clus.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_cross_data_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) else 1 end as id_flag from kpi.tr_temp_cross_data_aggr temp left join kpi.ms_lookup_master clus on clus.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 88) and temp.actor_key_v = clus.ext_ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_cross_data_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

#1179 - INTHDP015 - Outlet Program Achiever
1179_MONTHLY_JOIN_QUERY_1=select 1179 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n)  as source_type_n, coalesce(clus.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_outlet_program_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(clus.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_outlet_program_aggr', temp.temp_id_n, 'source_field%Actor mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_outlet_program_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_lookup_master clus on clus.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 88) and temp.source_key_v = clus.ext_ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_outlet_program_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

#1180 - INTHDP016 - Ontime Allocation Payment
1180_MONTHLY_JOIN_QUERY_1=select 1180 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(mpc.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n)  as source_type_n, coalesce(clus.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(mpc.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_ontime_payment_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(clus.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_ontime_payment_aggr', temp.temp_id_n, 'source_field%Actor mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_ontime_payment_aggr temp left join kpi.ms_org_master mpc on temp.actor_key_v = mpc.ref_code_v left join kpi.ms_lookup_master clus on clus.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 88) and temp.source_key_v = clus.ext_ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_ontime_payment_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n;

#1181 - INTHDP017 - URO 20K
#(1)
1181_DAILY_JOIN_QUERY_1=select 1181 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_uro_20k_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_uro_20k_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_uro_20k_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v where temp.file_id_n = ? and temp.actor_type_n = 10 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_uro_20k_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n; 
1181_MONTHLY_JOIN_QUERY_1=select 1181 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(org.aggregation_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(org.aggregation_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_uro_20k_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_uro_20k_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_uro_20k_aggr temp left join kpi.ms_org_master org on temp.actor_key_v = org.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 10 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_uro_20k_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n; 

#(2)
1181_DAILY_JOIN_QUERY_2=select 1181 as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and daily1.dimension_1_n is null) then null else coalesce(temp1.dimension_1_n, 0) end as dimension_1_n, case when (temp1.dimension_2_n is null and daily1.dimension_2_n is null) then null else coalesce(temp1.dimension_2_n, 0) end as dimension_2_n, case when (temp1.dimension_3_n is null and daily1.dimension_3_n is null) then null else coalesce(temp1.dimension_3_n, 0) end as dimension_3_n, case when (temp1.dimension_4_n is null and daily1.dimension_4_n is null) then null else coalesce(temp1.dimension_4_n, 0) end as dimension_4_n, case when (temp1.dimension_5_n is null and daily1.dimension_5_n is null) then null else coalesce(temp1.dimension_5_n, 0) end as dimension_5_n, case when (temp1.dimension_6_n is null and daily1.dimension_6_n is null) then null else coalesce(temp1.dimension_6_n, 0) end as dimension_6_n, case when (temp1.dimension_7_n is null and daily1.dimension_7_n is null) then null else coalesce(temp1.dimension_7_n, 0) end as dimension_7_n, case when (temp1.dimension_8_n is null and daily1.dimension_8_n is null) then null else coalesce(temp1.dimension_8_n, 0) end as dimension_8_n, case when (temp1.dimension_9_n is null and daily1.dimension_9_n is null) then null else coalesce(temp1.dimension_9_n, 0) end as dimension_9_n, case when (temp1.dimension_10_n is null and daily1.dimension_10_n is null) then null else coalesce(temp1.dimension_10_n, 0) end as dimension_10_n, case when (temp1.no_of_events_n is null and daily1.no_of_events_n is null) then null else coalesce(temp1.no_of_events_n, 0) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select temp.id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(site.site_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.actor_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_uro_20k_aggr', temp.temp_id_n, 'actor_field%Actor mapping not found for actor_field : ' || temp.actor_key_v) when temp.source_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_uro_20k_aggr', temp.temp_id_n, 'source_field%Source mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_uro_20k_aggr temp left join kpi.ms_site_master site on temp.actor_key_v = site.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v where temp.file_id_n = ? and temp.actor_type_n = 12 ) result where result.id_flag = 1 group by result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_daily_uro_20k_aggr daily1 on temp1.id_n = daily1.day_id_n and temp1.actor_type_n = daily1.actor_type_n and temp1.actor_id_n = daily1.actor_id_n and temp1.event_type_n = daily1.event_type_n and temp1.metrics_type_n = daily1.metrics_type_n and temp1.metrics_id_n = daily1.metrics_id_n and temp1.source_type_n = daily1.source_type_n and temp1.source_id_n = daily1.source_id_n and temp1.data_flag_n = daily1.data_flag_n and temp1.instance_type_n = daily1.instance_type_n and temp1.instance_id_n = daily1.instance_id_n; 
1181_MONTHLY_JOIN_QUERY_2=select 1181 as interface_id_n, temp1.month_id_n as id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, case when (temp1.dimension_1_n is null and monthly1.dimension_1_n is null) then null else (coalesce(temp1.dimension_1_n, 0) + coalesce(monthly1.dimension_1_n, 0)) end as dimension_1_n, case when (temp1.dimension_2_n is null and monthly1.dimension_2_n is null) then null else (coalesce(temp1.dimension_2_n, 0) + coalesce(monthly1.dimension_2_n, 0)) end as dimension_2_n, case when (temp1.dimension_3_n is null and monthly1.dimension_3_n is null) then null else (coalesce(temp1.dimension_3_n, 0) + coalesce(monthly1.dimension_3_n, 0)) end as dimension_3_n, case when (temp1.dimension_4_n is null and monthly1.dimension_4_n is null) then null else (coalesce(temp1.dimension_4_n, 0) + coalesce(monthly1.dimension_4_n, 0)) end as dimension_4_n, case when (temp1.dimension_5_n is null and monthly1.dimension_5_n is null) then null else (coalesce(temp1.dimension_5_n, 0) + coalesce(monthly1.dimension_5_n, 0)) end as dimension_5_n, case when (temp1.dimension_6_n is null and monthly1.dimension_6_n is null) then null else (coalesce(temp1.dimension_6_n, 0) + coalesce(monthly1.dimension_6_n, 0)) end as dimension_6_n, case when (temp1.dimension_7_n is null and monthly1.dimension_7_n is null) then null else (coalesce(temp1.dimension_7_n, 0) + coalesce(monthly1.dimension_7_n, 0)) end as dimension_7_n, case when (temp1.dimension_8_n is null and monthly1.dimension_8_n is null) then null else (coalesce(temp1.dimension_8_n, 0) + coalesce(monthly1.dimension_8_n, 0)) end as dimension_8_n, case when (temp1.dimension_9_n is null and monthly1.dimension_9_n is null) then null else (coalesce(temp1.dimension_9_n, 0) + coalesce(monthly1.dimension_9_n, 0)) end as dimension_9_n, case when (temp1.dimension_10_n is null and monthly1.dimension_10_n is null) then null else (coalesce(temp1.dimension_10_n, 0) + coalesce(monthly1.dimension_10_n, 0)) end as dimension_10_n, case when (temp1.no_of_events_n is null and monthly1.no_of_events_n is null) then null else (coalesce(temp1.no_of_events_n, 0) + coalesce(monthly1.no_of_events_n, 0)) end as no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n from (select result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, sum(result.dimension_1_n) as dimension_1_n, sum(result.dimension_2_n) as dimension_2_n, sum(result.dimension_3_n) as dimension_3_n, sum(result.dimension_4_n) as dimension_4_n, sum(result.dimension_5_n) as dimension_5_n, sum(result.dimension_6_n) as dimension_6_n, sum(result.dimension_7_n) as dimension_7_n, sum(result.dimension_8_n) as dimension_8_n, sum(result.dimension_9_n) as dimension_9_n, sum(result.dimension_10_n) as dimension_10_n, sum(result.no_of_events_n) as no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n from (select day_master.month_id_n, temp.actor_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.actor_type_n), temp.actor_type_n) as actor_type_n, coalesce(site.site_id_n, 0) as actor_id_n, temp.event_type_n, temp.metrics_key_v, 21 as metrics_type_n, 110 as metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.source_key_v, coalesce((select reference_type_n from kpi.ms_actor_lookup_master where actor_type_n = temp.source_type_n), temp.source_type_n) as source_type_n, coalesce(micro.lookup_id_n, 0) as source_id_n, temp.data_flag_n, temp.instance_key_v, 0 as instance_type_n, 0 as instance_id_n, temp.file_id_n, case when temp.source_key_v is not null and coalesce(site.site_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_uro_20k_aggr', temp.temp_id_n, 'actor_field%Source mapping not found for actor_field : ' || temp.actor_key_v) when temp.actor_key_v is not null and coalesce(micro.lookup_id_n, 0) = 0 then kpi.update_analytics_failed_row('tr_temp_uro_20k_aggr', temp.temp_id_n, 'source_field%Actor mapping not found for source_field : ' || temp.source_key_v) else 1 end as id_flag from kpi.tr_temp_uro_20k_aggr temp left join kpi.ms_site_master site on temp.actor_key_v = site.ref_code_v left join kpi.ms_lookup_master micro on micro.lookup_type_n = (select lookup_type_n from kpi.ms_lookup_type_master where ext_lookup_type_n = 89) and temp.source_key_v = micro.ext_ref_code_v inner join kpi.ms_day_master as day_master on temp.id_n = day_master.day_id_n where temp.file_id_n = ? and temp.actor_type_n = 12 and temp.status_flag_n = 0 ) result where result.id_flag = 1 group by result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 left join kpi.tr_monthly_uro_20k_aggr monthly1 on temp1.month_id_n = monthly1.month_id_n and temp1.actor_type_n = monthly1.actor_type_n and temp1.actor_id_n = monthly1.actor_id_n and temp1.event_type_n = monthly1.event_type_n and temp1.metrics_type_n = monthly1.metrics_type_n and temp1.metrics_id_n = monthly1.metrics_id_n and temp1.source_type_n = monthly1.source_type_n and temp1.source_id_n = monthly1.source_id_n and temp1.data_flag_n = monthly1.data_flag_n and temp1.instance_type_n = monthly1.instance_type_n and temp1.instance_id_n = monthly1.instance_id_n; 


#################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################

##NOT EXIST LOOKUP QUERIES..
1064_NOT_EXIST_QUERY={"METRICS":{"select":"select a.metrics_key_v, a.metrics_key_v, 34 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from( select distinct metrics_key_v from kpi.tr_temp_upload_metrics_revenue_aggr where file_id_n = ?) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 34) union select a.metrics_key_v, a.metrics_key_v, 36 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from ( select distinct instance_key_v as metrics_key_v from kpi.tr_temp_upload_metrics_revenue_aggr where file_id_n = ? ) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 36)","insert":"insert into kpi.ms_metrics_master(metrics_name_v, description_v, metrics_type_n, ext_reference_id_v, definition_v) values (?, ?, ?, ?, ?)","select-placeholders":2,"insert-placeholders":[{"1":"string"},{"2":"string"},{"3":"long"},{"4":"string"},{"5":"string"}]}}
1065_NOT_EXIST_QUERY={"METRICS":{"select":"select a.metrics_key_v, a.metrics_key_v, 35 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from( select distinct metrics_key_v from kpi.tr_temp_upload_metrics_revenue_aggr where file_id_n = ?) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 35)","insert":"insert into kpi.ms_metrics_master(metrics_name_v, description_v, metrics_type_n, ext_reference_id_v, definition_v) values (?, ?, ?, ?, ?)","select-placeholders":1,"insert-placeholders":[{"1":"string"},{"2":"string"},{"3":"long"},{"4":"string"},{"5":"string"}]}}
1067_NOT_EXIST_QUERY={"METRICS":{"select":"select a.metrics_key_v, a.metrics_key_v, 33 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from( select distinct metrics_key_v from kpi.tr_temp_upload_metrics_revenue_aggr where file_id_n = ?) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 33)","insert":"insert into kpi.ms_metrics_master(metrics_name_v, description_v, metrics_type_n, ext_reference_id_v, definition_v) values (?, ?, ?, ?, ?)","select-placeholders":1,"insert-placeholders":[{"1":"string"},{"2":"string"},{"3":"long"},{"4":"string"},{"5":"string"}]}}
1068_NOT_EXIST_QUERY={"METRICS":{"select":"select a.metrics_key_v, a.metrics_key_v, 13 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from( select distinct metrics_key_v from kpi.tr_temp_upload_metrics_aggr where file_id_n = ?) a where a.metrics_key_v not in (select metrics_name_v from kpi.ms_metrics_master where metrics_type_n = 13 and status_n in(1,174)) union select a.metrics_key_v, a.metrics_key_v, 31 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from ( select distinct instance_key_v as metrics_key_v from kpi.tr_temp_upload_metrics_aggr where file_id_n = ? ) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 31)","insert":"insert into kpi.ms_metrics_master(metrics_name_v, description_v, metrics_type_n, ext_reference_id_v, definition_v) values (?, ?, ?, ?, ?)","select-placeholders":2,"insert-placeholders":[{"1":"string"},{"2":"string"},{"3":"long"},{"4":"string"},{"5":"string"}]}}
1069_NOT_EXIST_QUERY={"METRICS":{"select":"select a.metrics_key_v, a.metrics_key_v, 13 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from( select distinct metrics_key_v from kpi.tr_temp_upload_metrics_aggr where file_id_n = ?) a where a.metrics_key_v not in (select metrics_name_v from kpi.ms_metrics_master where metrics_type_n = 13 and status_n in(1,174)) union select a.metrics_key_v, a.metrics_key_v, 31 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from ( select distinct instance_key_v as metrics_key_v from kpi.tr_temp_upload_metrics_aggr where file_id_n = ? ) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 31)","insert":"insert into kpi.ms_metrics_master(metrics_name_v, description_v, metrics_type_n, ext_reference_id_v, definition_v) values (?, ?, ?, ?, ?)","select-placeholders":2,"insert-placeholders":[{"1":"string"},{"2":"string"},{"3":"long"},{"4":"string"},{"5":"string"}]}}
1070_NOT_EXIST_QUERY={"METRICS":{"select":"select a.metrics_key_v, a.metrics_key_v, 37 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from( select distinct metrics_key_v from kpi.tr_temp_upload_metrics_revenue_aggr where file_id_n = ? and metrics_type_n = 37) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 37) union select a.metrics_key_v, a.metrics_key_v, 39 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from ( select distinct metrics_key_v from kpi.tr_temp_upload_metrics_revenue_aggr where file_id_n = ? and metrics_type_n = 39 ) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 39) union select a.metrics_key_v, a.metrics_key_v, 40 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from ( select distinct instance_key_v as metrics_key_v from kpi.tr_temp_upload_metrics_revenue_aggr where file_id_n = ? ) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 40)","insert":"insert into kpi.ms_metrics_master(metrics_name_v, description_v, metrics_type_n, ext_reference_id_v, definition_v) values (?, ?, ?, ?, ?)","select-placeholders":3,"insert-placeholders":[{"1":"string"},{"2":"string"},{"3":"long"},{"4":"string"},{"5":"string"}]}}
1075_NOT_EXIST_QUERY={"METRICS":{"select":"select a.instance_key_v as metrics_key_v, a.instance_key_v as metrics_key_v, 33 as metrics_type_n, a.instance_key_v as metrics_key_v, 'Interface' as definition_v from (select distinct instance_key_v from kpi.tr_temp_upload_metrics_trans_aggr where file_id_n = ?) a where a.instance_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 33)","insert":"insert into kpi.ms_metrics_master(metrics_name_v, description_v, metrics_type_n, ext_reference_id_v, definition_v) values (?, ?, ?, ?, ?)","select-placeholders":1,"insert-placeholders":[{"1":"string"},{"2":"string"},{"3":"long"},{"4":"string"},{"5":"string"}]}}
1076_NOT_EXIST_QUERY={"METRICS":{"select":"select a.metrics_key_v, a.metrics_key_v, 30 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from( select distinct metrics_key_v from kpi.tr_temp_upload_metrics_aggr where file_id_n = ?) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 30) union select a.metrics_key_v, a.metrics_key_v, 38 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from ( select distinct instance_key_v as metrics_key_v from kpi.tr_temp_upload_metrics_aggr where file_id_n = ? ) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 38)","insert":"insert into kpi.ms_metrics_master(metrics_name_v, description_v, metrics_type_n, ext_reference_id_v, definition_v) values (?, ?, ?, ?, ?)","select-placeholders":2,"insert-placeholders":[{"1":"string"},{"2":"string"},{"3":"long"},{"4":"string"},{"5":"string"}]}}
1077_NOT_EXIST_QUERY={"METRICS":{"select":"select a.metrics_key_v, a.metrics_key_v, 30 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from( select distinct metrics_key_v from kpi.tr_temp_upload_metrics_aggr where file_id_n = ?) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 30) union select a.metrics_key_v, a.metrics_key_v,  38 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from ( select distinct instance_key_v as metrics_key_v from kpi.tr_temp_upload_metrics_aggr where file_id_n = ? ) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 38)","insert":"insert into kpi.ms_metrics_master(metrics_name_v, description_v, metrics_type_n, ext_reference_id_v, definition_v) values (?, ?, ?, ?, ?)","select-placeholders":2,"insert-placeholders":[{"1":"string"},{"2":"string"},{"3":"long"},{"4":"string"},{"5":"string"}]}}
1078_NOT_EXIST_QUERY={"ACTOR":{"select":"select 7 as actor_type_n, a.actor_key_v from (select distinct actor_key_v from kpi.tr_temp_upload_metrics_aggr temp inner join kpi.tr_msisdn_product_mapping mp on temp.actor_key_v = mp.msisdn_v where file_id_n = ?) a where a.actor_key_v not in (select actor_id_v from kpi.ms_actor_master where actor_type_n = 7)","insert":"insert into kpi.ms_actor_master(actor_type_n, actor_id_v) values (?, ?)","select-placeholders":1,"insert-placeholders":[{"1":"long"},{"2":"string"}]}}
1079_NOT_EXIST_QUERY={"ACTOR":{"select":"select 7 as actor_type_n, a.actor_key_v from (select distinct actor_key_v from kpi.tr_temp_upload_metrics_aggr temp inner join kpi.tr_msisdn_product_mapping mp on temp.actor_key_v = mp.msisdn_v where file_id_n = ?) a where a.actor_key_v not in (select actor_id_v from kpi.ms_actor_master where actor_type_n = 7)","insert":"insert into kpi.ms_actor_master(actor_type_n, actor_id_v) values (?, ?)","select-placeholders":1,"insert-placeholders":[{"1":"long"},{"2":"string"}]}}
1080_NOT_EXIST_QUERY={"ACTOR":{"select":"select 7 as actor_type_n, a.actor_key_v from (select distinct actor_key_v from kpi.tr_temp_upload_metrics_aggr temp inner join kpi.tr_msisdn_product_mapping mp on temp.actor_key_v = mp.msisdn_v where file_id_n = ?) a where a.actor_key_v not in (select actor_id_v from kpi.ms_actor_master where actor_type_n = 7)","insert":"insert into kpi.ms_actor_master(actor_type_n, actor_id_v) values (?, ?)","select-placeholders":1,"insert-placeholders":[{"1":"long"},{"2":"string"}]}}
1082_NOT_EXIST_QUERY={"METRICS":{"select":"select a.metrics_key_v, a.metrics_key_v, 34 as metrics_type_n, a.metrics_key_v, 'Interface' as definition_v from( select distinct metrics_key_v from kpi.tr_temp_upload_metrics_orgbal_aggr where file_id_n = ?) a where a.metrics_key_v not in (select ext_reference_id_v from kpi.ms_metrics_master where metrics_type_n = 34)","insert":"insert into kpi.ms_metrics_master(metrics_name_v, description_v, metrics_type_n, ext_reference_id_v, definition_v) values (?, ?, ?, ?, ?)","select-placeholders":1,"insert-placeholders":[{"1":"string"},{"2":"string"},{"3":"long"},{"4":"string"},{"5":"string"}]}}

## HADOOP FEED LOOKUP NOT EXITS CONFIGURATION FOR SITE SOURCE
1168_NOT_EXIST_QUERY={ 	"ACTOR": { "select": "select actor.actor_key_v as site_name_v, actor.actor_key_v as ref_code_v from (select distinct actor_key_v from kpi.tr_temp_daily_sso_aggr where file_id_n = ?) actor where actor.actor_key_v not in (select ref_code_v from kpi.ms_site_master)", "insert": "insert into kpi.ms_site_master(site_name_v, ref_code_v) values (?, ?)", "select-placeholders": 1, "insert-placeholders": [{ "1": "string"}, { "2": "string" } ]}}
1169_NOT_EXIST_QUERY={ 	"ACTOR": { "select": "select actor.actor_key_v as site_name_v, actor.actor_key_v as ref_code_v from (select distinct actor_key_v from kpi.tr_temp_rguga_injection_aggr where file_id_n = ?) actor where actor.actor_key_v not in (select ref_code_v from kpi.ms_site_master)", "insert": "insert into kpi.ms_site_master(site_name_v, ref_code_v) values (?, ?)", "select-placeholders": 1, "insert-placeholders": [{ "1": "string"}, { "2": "string" } ]}}
1170_NOT_EXIST_QUERY={ 	"ACTOR": { "select": "select actor.actor_key_v as site_name_v, actor.actor_key_v as ref_code_v from (select distinct actor_key_v from kpi.tr_temp_tertiary_sales_aggr where file_id_n = ?) actor where actor.actor_key_v not in (select ref_code_v from kpi.ms_site_master)", "insert": "insert into kpi.ms_site_master(site_name_v, ref_code_v) values (?, ?)", "select-placeholders": 1, "insert-placeholders": [{ "1": "string"}, { "2": "string" } ]}}
1172_NOT_EXIST_QUERY={ 	"SOURCE": { "select": "select source.source_key_v as site_name_v, source.source_key_v as ref_code_v from (select distinct source_key_v from kpi.tr_temp_total_usage_aggr where file_id_n = ?) source where source.source_key_v not in (select ref_code_v from kpi.ms_site_master)", "insert": "insert into kpi.ms_site_master(site_name_v, ref_code_v) values (?, ?)", "select-placeholders": 1, "insert-placeholders": [{ "1": "string"}, { "2": "string" } ]}}
1173_NOT_EXIST_QUERY={ 	"SOURCE": { "select": "select source.source_key_v as site_name_v, source.source_key_v as ref_code_v from (select distinct source_key_v from kpi.tr_temp_mobo_usage_aggr where file_id_n = ?) source where source.source_key_v not in (select ref_code_v from kpi.ms_site_master)", "insert": "insert into kpi.ms_site_master(site_name_v, ref_code_v) values (?, ?)", "select-placeholders": 1, "insert-placeholders": [{ "1": "string"}, { "2": "string" } ]}}
1174_NOT_EXIST_QUERY={ 	"SOURCE": { "select": "select source.source_key_v as site_name_v, source.source_key_v as ref_code_v from (select distinct source_key_v from kpi.tr_temp_total_rguga_aggr where file_id_n = ?) source where source.source_key_v not in (select ref_code_v from kpi.ms_site_master)", "insert": "insert into kpi.ms_site_master(site_name_v, ref_code_v) values (?, ?)", "select-placeholders": 1, "insert-placeholders": [{ "1": "string"}, { "2": "string" } ]}}
1175_NOT_EXIST_QUERY={ 	"SOURCE": { "select": "select source.source_key_v as site_name_v, source.source_key_v as ref_code_v from (select distinct source_key_v from kpi.tr_temp_low_revenue_site_aggr where file_id_n = ?) source where source.source_key_v not in (select ref_code_v from kpi.ms_site_master)", "insert": "insert into kpi.ms_site_master(site_name_v, ref_code_v) values (?, ?)", "select-placeholders": 1, "insert-placeholders": [{ "1": "string"}, { "2": "string" } ]}}
1176_NOT_EXIST_QUERY={ 	"SOURCE": { "select": "select source.source_key_v as site_name_v, source.source_key_v as ref_code_v from (select distinct source_key_v from kpi.tr_temp_site_rguga_aggr where file_id_n = ?) source where source.source_key_v not in (select ref_code_v from kpi.ms_site_master)", "insert": "insert into kpi.ms_site_master(site_name_v, ref_code_v) values (?, ?)", "select-placeholders": 1, "insert-placeholders": [{ "1": "string"}, { "2": "string" } ]}}
1181_NOT_EXIST_QUERY={ 	"ACTOR": { "select": "select actor.actor_key_v as site_name_v, actor.actor_key_v as ref_code_v from (select distinct actor_key_v from kpi.tr_temp_uro_20k_aggr where file_id_n = ?) actor where actor.actor_key_v not in (select ref_code_v from kpi.ms_site_master)", "insert": "insert into kpi.ms_site_master(site_name_v, ref_code_v) values (?, ?)", "select-placeholders": 1, "insert-placeholders": [{ "1": "string"}, { "2": "string" } ]}}

#################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################################


##CROSS SELLING QUERIES..
1075_CROSS_SELL_DAILY=SELECT '1075_CS'::character varying as interface_id_n, temp1.id_n, daily1.day_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN ( temp1.dimension_1_n IS NULL AND daily1.dimension_1_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(daily1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND daily1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(daily1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND daily1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(daily1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND daily1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(daily1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND daily1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(daily1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND daily1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(daily1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND daily1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(daily1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND daily1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(daily1.dimension_8_n, 0)) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND daily1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(daily1.dimension_9_n, 0)) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND daily1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(daily1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND daily1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(daily1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM (SELECT fData.temp_id_n, fData.id_n, fData.actor_key_v, case when (fData.crossell_flag_n = 1 OR fData.crossell_flag_n = 2) then 3 else fData.actor_type_n end as actor_type_n, case when (fData.crossell_flag_n = 1 OR fData.crossell_flag_n = 2) then fData.operator_id else fData.actor_id_n end as actor_id_n, fData.event_type_n, fData.metrics_key_v, fData.metrics_type_n, fData.metrics_id_n, fData.dimension_1_n, fData.dimension_2_n, fData.dimension_3_n, fData.dimension_4_n, fData.dimension_5_n, fData.dimension_6_n, fData.dimension_7_n, fData.dimension_8_n, fData.dimension_9_n, fData.dimension_10_n, fData.no_of_events_n, fData.source_key_v, fData.source_type_n, fData.source_id as source_id_n, fData.crossell_flag_n as data_flag_n, fData.instance_key_v, fData.source_id_n as instance_type_n, fData.destination_id_n as instance_id_n, fData.file_id_n, fData.id_flag FROM (SELECT (kpi.fetch_cross_selling_details(a.user_hierarchy, a.a_hierarchy, a.b_hierarchy)).*, a.* FROM (SELECT temp.temp_id_n, temp.id_n, temp.acellid_v as actor_key_v, 8 as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, split_part(temp.metrics_key_v, ',', 6) as metrics_key_v, 13 as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.actor_key_v as source_key_v, 1 as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id, temp.data_flag_n, null as instance_key_v, 0 as instance_type_n, 0 AS instance_id_n, COALESCE(usr.aggregation_id_n, 0) AS operator_id, usr.territory_id_n as user_territory_id, usr.sales_territory_id_v as user_hierarchy, anm.aggregation_id_n as alacci_id, anm.territory_id_n as a_territory_id, anm.sales_territory_id_v as a_hierarchy, bnm.aggregation_id_n as blacci_id, bnm.territory_id_n as b_territory_id, bnm.sales_territory_id_v as b_hierarchy, temp.file_id_n, CASE WHEN temp.acellid_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN -1 WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN -1 WHEN temp.actor_key_v IS NOT NULL AND COALESCE(usr.aggregation_id_n, 0) = 0 THEN -1 ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp INNER JOIN kpi.ms_network_master nm ON temp.acellid_v = nm.lacci_id_v INNER JOIN kpi.ms_metrics_master met ON ( split_part(temp.metrics_key_v, ',', 6) = met.metrics_name_v AND met.metrics_type_n = 13 AND met.status_n IN (1, 174)) INNER JOIN kpi.ms_report_user_master usr ON (temp.actor_key_v = usr.operator_id_v and usr.is_current_user_v ilike 'yes') INNER JOIN kpi.ms_report_network_master bnm ON temp.bcellid_v = bnm.lacci_id_v INNER JOIN kpi.ms_report_network_master anm ON temp.acellid_v = anm.lacci_id_v INNER JOIN kpi.ms_org_master org ON (temp.source_key_v = org.ref_code_v and org.status_n = 174) WHERE temp.file_id_n = ? and temp.status_flag_n = 0) a WHERE a.id_flag = 1) fData) result GROUP BY result.id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_daily_mobo_crosselling_aggr daily1 ON temp1.id_n = daily1.day_id_n AND temp1.actor_type_n = daily1.actor_type_n AND temp1.actor_id_n = daily1.actor_id_n AND temp1.event_type_n = daily1.event_type_n AND temp1.metrics_type_n = daily1.metrics_type_n AND temp1.metrics_id_n = daily1.metrics_id_n AND temp1.source_type_n = daily1.source_type_n AND temp1.source_id_n = daily1.source_id_n AND temp1.data_flag_n = daily1.data_flag_n AND temp1.instance_type_n = daily1.instance_type_n AND temp1.instance_id_n = daily1.instance_id_n;
1075_CROSS_SELL_MONTHLY=SELECT '1075_CS'::character varying as interface_id_n, temp1.month_id_n AS id_n, monthly1.month_id_n, temp1.actor_type_n, temp1.actor_id_n, temp1.event_type_n, temp1.metrics_type_n, temp1.metrics_id_n, CASE WHEN ( temp1.dimension_1_n IS NULL AND monthly1.dimension_1_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_1_n, 0) + COALESCE(monthly1.dimension_1_n, 0)) END AS dimension_1_n, CASE WHEN ( temp1.dimension_2_n IS NULL AND monthly1.dimension_2_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_2_n, 0) + COALESCE(monthly1.dimension_2_n, 0)) END AS dimension_2_n, CASE WHEN ( temp1.dimension_3_n IS NULL AND monthly1.dimension_3_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_3_n, 0) + COALESCE(monthly1.dimension_3_n, 0)) END AS dimension_3_n, CASE WHEN ( temp1.dimension_4_n IS NULL AND monthly1.dimension_4_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_4_n, 0) + COALESCE(monthly1.dimension_4_n, 0)) END AS dimension_4_n, CASE WHEN ( temp1.dimension_5_n IS NULL AND monthly1.dimension_5_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_5_n, 0) + COALESCE(monthly1.dimension_5_n, 0)) END AS dimension_5_n, CASE WHEN ( temp1.dimension_6_n IS NULL AND monthly1.dimension_6_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_6_n, 0) + COALESCE(monthly1.dimension_6_n, 0)) END AS dimension_6_n, CASE WHEN ( temp1.dimension_7_n IS NULL AND monthly1.dimension_7_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_7_n, 0) + COALESCE(monthly1.dimension_7_n, 0)) END AS dimension_7_n, CASE WHEN ( temp1.dimension_8_n IS NULL AND monthly1.dimension_8_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_8_n, 0) + COALESCE(monthly1.dimension_8_n, 0) ) END AS dimension_8_n, CASE WHEN ( temp1.dimension_9_n IS NULL AND monthly1.dimension_9_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_9_n, 0) + COALESCE(monthly1.dimension_9_n, 0) ) END AS dimension_9_n, CASE WHEN ( temp1.dimension_10_n IS NULL AND monthly1.dimension_10_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.dimension_10_n, 0) + COALESCE(monthly1.dimension_10_n, 0)) END AS dimension_10_n, CASE WHEN ( temp1.no_of_events_n IS NULL AND monthly1.no_of_events_n IS NULL ) THEN NULL ELSE (COALESCE(temp1.no_of_events_n, 0) + COALESCE(monthly1.no_of_events_n, 0)) END AS no_of_events_n, temp1.source_type_n, temp1.source_id_n, temp1.data_flag_n, temp1.instance_type_n, temp1.instance_id_n FROM ( SELECT result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, Sum(result.dimension_1_n) AS dimension_1_n, Sum(result.dimension_2_n) AS dimension_2_n, Sum(result.dimension_3_n) AS dimension_3_n, Sum(result.dimension_4_n) dimension_4_n, Sum(result.dimension_5_n) AS dimension_5_n, Sum(result.dimension_6_n) AS dimension_6_n, Sum(result.dimension_7_n) AS dimension_7_n, Sum(result.dimension_8_n) AS dimension_8_n, Sum(result.dimension_9_n) AS dimension_9_n, Sum(result.dimension_10_n) AS dimension_10_n, Sum(result.no_of_events_n) AS no_of_events_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n FROM (SELECT fData.temp_id_n, fData.month_id_n, fData.actor_key_v, case when (fData.crossell_flag_n = 1 OR fData.crossell_flag_n = 2) then 3 else fData.actor_type_n end as actor_type_n, case when (fData.crossell_flag_n = 1 OR fData.crossell_flag_n = 2) then fData.operator_id else fData.actor_id_n end as actor_id_n, fData.event_type_n, fData.metrics_key_v, fData.metrics_type_n, fData.metrics_id_n, fData.dimension_1_n, fData.dimension_2_n, fData.dimension_3_n, fData.dimension_4_n, fData.dimension_5_n, fData.dimension_6_n, fData.dimension_7_n, fData.dimension_8_n, fData.dimension_9_n, fData.dimension_10_n, fData.no_of_events_n, fData.source_key_v, fData.source_type_n, fData.source_id as source_id_n, fData.crossell_flag_n as data_flag_n, fData.instance_key_v, fData.source_id_n as instance_type_n, fData.destination_id_n as instance_id_n, fData.file_id_n, fData.id_flag FROM (SELECT (kpi.fetch_cross_selling_details(a.user_hierarchy, a.a_hierarchy, a.b_hierarchy)).*, a.* FROM (SELECT temp.temp_id_n, day_master.month_id_n, temp.acellid_v as actor_key_v, 8 as actor_type_n, COALESCE(nm.aggregation_id_n, 0) AS actor_id_n, temp.event_type_n, split_part(temp.metrics_key_v, ',', 6) as metrics_key_v, 13 as metrics_type_n, COALESCE(met.metrics_id_n, 0) AS metrics_id_n, temp.dimension_1_n, temp.dimension_2_n, temp.dimension_3_n, temp.dimension_4_n, temp.dimension_5_n, temp.dimension_6_n, temp.dimension_7_n, temp.dimension_8_n, temp.dimension_9_n, temp.dimension_10_n, temp.no_of_events_n, temp.actor_key_v as source_key_v, 1 as source_type_n, COALESCE(org.aggregation_id_n, 0) AS source_id, temp.data_flag_n, null as instance_key_v, 0 as instance_type_n, 0 AS instance_id_n, COALESCE(usr.aggregation_id_n, 0) AS operator_id, usr.territory_id_n as user_territory_id, usr.sales_territory_id_v as user_hierarchy, anm.aggregation_id_n as alacci_id, anm.territory_id_n as a_territory_id, anm.sales_territory_id_v as a_hierarchy, bnm.aggregation_id_n as blacci_id, bnm.territory_id_n as b_territory_id, bnm.sales_territory_id_v as b_hierarchy, temp.file_id_n, CASE WHEN temp.acellid_v IS NOT NULL AND COALESCE(nm.aggregation_id_n, 0) = 0 THEN -1 WHEN temp.metrics_key_v IS NOT NULL AND COALESCE(met.metrics_id_n, 0) = 0 THEN -1 WHEN temp.actor_key_v IS NOT NULL AND COALESCE(usr.aggregation_id_n, 0) = 0 THEN -1 ELSE 1 END AS id_flag FROM kpi.tr_temp_upload_metrics_trans_aggr temp INNER JOIN kpi.ms_network_master nm ON temp.acellid_v = nm.lacci_id_v INNER JOIN kpi.ms_metrics_master met ON ( split_part(temp.metrics_key_v, ',', 6) = met.metrics_name_v AND met.metrics_type_n = 13 AND met.status_n IN (1, 174)) INNER JOIN kpi.ms_report_user_master usr ON (temp.actor_key_v = usr.operator_id_v and usr.is_current_user_v ilike 'yes') INNER JOIN kpi.ms_report_network_master bnm ON temp.bcellid_v = bnm.lacci_id_v INNER JOIN kpi.ms_report_network_master anm ON temp.acellid_v = anm.lacci_id_v INNER JOIN kpi.ms_org_master org ON (temp.source_key_v = org.ref_code_v and org.status_n = 174) INNER JOIN kpi.ms_day_master AS day_master ON (temp.id_n = day_master.day_id_n) WHERE temp.file_id_n = ? and temp.status_flag_n = 0) a WHERE a.id_flag = 1) fData) result GROUP BY result.month_id_n, result.actor_type_n, result.actor_id_n, result.event_type_n, result.metrics_type_n, result.metrics_id_n, result.source_type_n, result.source_id_n, result.data_flag_n, result.instance_type_n, result.instance_id_n, result.file_id_n ) temp1 LEFT JOIN kpi.tr_monthly_mobo_crosselling_aggr monthly1 ON temp1.month_id_n = monthly1.month_id_n AND temp1.actor_type_n = monthly1.actor_type_n AND temp1.actor_id_n = monthly1.actor_id_n AND temp1.event_type_n = monthly1.event_type_n AND temp1.metrics_type_n = monthly1.metrics_type_n AND temp1.metrics_id_n = monthly1.metrics_id_n AND temp1.source_type_n = monthly1.source_type_n AND temp1.source_id_n = monthly1.source_id_n AND temp1.data_flag_n = monthly1.data_flag_n AND temp1.instance_type_n = monthly1.instance_type_n AND temp1.instance_id_n = monthly1.instance_id_n;
