--1106 (DAILY_DUMP - SOM Summary Org Wise)
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106001, 1106, 'Remote Host', 'REMOTE_HOST', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106002, 1106, 'Remote Port', 'REMOTE_PORT', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106003, 1106, 'Remote User', 'REMOTE_USER', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106004, 1106, 'Remote Password', 'REMOTE_PWD', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106005, 1106, 'Remote File', 'SOM_Summary_Organization_Wise', now());                                                                             
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106006, 1106, 'Remote FileName Format', 'yyyyMMdd', now());                                                                          
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106007, 1106, 'Remote File Format', 'csv', now());                                                                                         
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106008, 1106, 'Control file format', 'ctl', now());                                                                                        
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106009, 1106, 'Remote Dir', '/home/appuser/interfaces/DAILY_DUMPS/master_files/som_summary_org_wise/', now());                 
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106010, 1106, 'Remote control directory', '/home/appuser/interfaces/DAILY_DUMPS/master_files/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106011, 1106, 'Remote rejected directory', '/home/appuser/interfaces/DAILY_DUMPS/rejected_file/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106012, 1106, 'Remote rejected control directory', '/home/appuser/interfaces/DAILY_DUMPS/rejected_file/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106013, 1106, 'Remote backup directory', '/home/appuser/interfaces/DAILY_DUMPS/backup/master_files/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106014, 1106, 'Remote Control Backup Directory', '/home/appuser/interfaces/DAILY_DUMPS/backup/master_files/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106015, 1106, 'Local Dir', '/snoc/interfaces/S-NOC/interfaces/master_file/daily_dumps/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106016, 1106, 'Local control directory', '/snoc/interfaces/S-NOC/interfaces/master_file/daily_dumps/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106017, 1106, 'Local backup directory', '/snoc/interfaces/S-NOC/interfaces/backup/master_file/daily_dumps/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106018, 1106, 'Local Control Backup Directory', '/snoc/interfaces/S-NOC/interfaces/backup/master_file/daily_dumps/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106019, 1106, 'Local rejected directory', '/snoc/interfaces/S-NOC/interfaces/rejected_file/daily_dumps/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106020, 1106, 'Local rejected control directory', '/snoc/interfaces/S-NOC/interfaces/rejected_file/daily_dumps/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106021, 1106, 'Local rejected backup directory', '/snoc/interfaces/S-NOC/interfaces/backup/rejected_file/daily_dumps/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106022, 1106, 'Local rejected control backup directory', '/snoc/interfaces/S-NOC/interfaces/backup/rejected_file/daily_dumps/som_summary_org_wise/', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106023, 1106, 'Received File Type', 'Request File Type', now());                                                                           
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106024, 1106, 'Csv Delimeter', '|', now());                                                                                               
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106025, 1106, 'File Headers', 'Channel|Region|Area|Sales Area|Cluster|Micro Cluster|Additional Territory|TerriotryID|Organization Type|Organization ID|Organization ShortCode|Organization Name|Product Brand|Product Type|Product Category|PRODUCT ID|PRODUCT EXT ID|PRODUCT NAME|Qty|Avg Gross (7 Day)|SOM(Day Remaining)', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106026, 1106, 'Client Id', '0', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106027, 1106, 'Is Sftp', 'true', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106028, 1106, 'Daily Dump Conf', '{"channel":"channel","region":"region","area":"area","sales area":"salesarea","cluster":"cluster","micro cluster":"microcluster","additional territory":"additionalterritory","terriotryid":"territoryid","organization type":"suborgtype","organization id":"organizationid","organization shortcode":"orgshortcode","organization name":"organizationname","product brand":"productbrand","product type":"producttype","product category":"productcategory","product id":"productid","product ext id":"productextid","product name":"productname","qty":"qty","avg gross (7 day)":"avgqty","som(day remaining)":"businessdays"}', now());
INSERT INTO INTERFACE.MS_INTERFACE_ATTR (ATTRIBUTE_ID_N, INTERFACE_ID_N, NAME_V, VALUE_V, LAST_UPDATED_TIME_DT) VALUES (1106029, 1106, 'query', 'select ''1106_SOM_Summary_Organization_Wise'' as report_name, report_org_master.channel_category_v as channel, report_org_master.region_v as region, report_org_master.area_v as area, report_org_master.sales_area_v as salesarea, report_org_master.cluster_v as cluster, report_org_master.micro_cluster_v as microcluster, null as additionalterritory, report_org_master.org_short_code_v as territoryid, report_org_master.sub_org_type_name_v as suborgtype, report_org_master.org_id_n::text as organizationid, report_org_master.org_short_code_v as orgshortcode, report_org_master.org_name_v as organizationname, product_brand.metrics_name_v as productbrand, null as producttype, product_category.metrics_name_v as productcategory, product_master.metrics_id_n::text as productid, product_master.ext_reference_id_v as productextid, product_master.metrics_name_v as productname, sum(groupby_query_results.closing_qty_n) as qty, case when (sum(groupby_query_results.stock_in_qty_n) - sum(groupby_query_results.stock_out_qty_n)) > 0 then round(((sum(groupby_query_results.stock_in_qty_n) - sum(groupby_query_results.stock_out_qty_n))/7),0) else (sum(groupby_query_results.stock_in_qty_n) - sum(groupby_query_results.stock_out_qty_n)) end as avgqty, case when (sum(groupby_query_results.stock_in_qty_n) - sum(groupby_query_results.stock_out_qty_n)) > 0 and round(((sum(groupby_query_results.stock_in_qty_n) - sum(groupby_query_results.stock_out_qty_n))/7),0) > 0 then round((sum(groupby_query_results.closing_qty_n)/round(((sum(groupby_query_results.stock_in_qty_n) - sum(groupby_query_results.stock_out_qty_n))/7),0)),0) else -1 end as businessdays from (select daily_stock_ledger.org_id_n as org_id_n, daily_stock_ledger.metrics_id_n as metrics_id_n, sum(daily_stock_ledger.closing_stock_qty_n) as closing_qty_n, sum(average_stock_ledger.stock_in_qty_n) as stock_in_qty_n, sum(average_stock_ledger.stock_out_qty_n) as stock_out_qty_n from kpi.tr_daily_stock_ledger as daily_stock_ledger inner join kpi.tr_daily_stock_ledger as average_stock_ledger on (daily_stock_ledger.day_id_n = (select to_number(to_char((select date ''yesterday''),''yyyymmdd''),''99999999'')) and average_stock_ledger.day_id_n between (select to_char((select date ''yesterday'' - interval ''6 days''),''yyyymmdd'')::numeric) and daily_stock_ledger.day_id_n and daily_stock_ledger.account_id_n = average_stock_ledger.account_id_n and daily_stock_ledger.node_id_n = average_stock_ledger.node_id_n and daily_stock_ledger.org_id_n = average_stock_ledger.org_id_n and daily_stock_ledger.metrics_id_n = average_stock_ledger.metrics_id_n) group by daily_stock_ledger.org_id_n, daily_stock_ledger.metrics_id_n ) as groupby_query_results inner join kpi.ms_report_org_master as report_org_master on (report_org_master.org_id_n = groupby_query_results.org_id_n) inner join kpi.ms_metrics_master as product_master on (groupby_query_results.metrics_id_n = product_master.metrics_id_n) inner join kpi.ms_metrics_master as product_category on (product_category.metrics_type_n = 11 and product_category.metrics_id_n = product_master.category_id_n) left join kpi.ms_metrics_master as product_brand on (product_brand.metrics_type_n = 16::numeric and product_brand.metrics_id_n = product_master.brand_id_n) group by channel, region, area, salesarea, cluster, microcluster, additionalterritory, territoryid, suborgtype, organizationid, orgshortcode, organizationname,productbrand,producttype, productcategory, productname, productid,productextid', now());
